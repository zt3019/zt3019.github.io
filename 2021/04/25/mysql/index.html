

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="	#87CEFA">
  <meta name="description" content="Just Do it!">
  <meta name="author" content="daxiazou">
  <meta name="keywords" content="">
  
    <meta name="baidu-site-verification" content="code-wxp4a58PBe" />
  
  <title>MySQL - Nevermind</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Nevermind</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://img.php.cn/upload/article/202009/15/2020091513341811712.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MySQL">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-25 14:23" pubdate>
        2021年4月25日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      10k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      124
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2024年8月29日 晚上
                
              </p>
            
            <div class="markdown-body">
              <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><img src="https://pic2.zhimg.com/9bb3acbba65f349299df27a93286ffb1_r.jpg" srcset="/img/loading.gif" lazyload alt="Mysql架构"></p>
<ul>
<li><p>连接层：最上层是一些客户端和连接服务。主要完成一些类似于连接处理，授权认证以及相关的安全方案。</p>
</li>
<li><p>服务层：</p>
<table>
<thead>
<tr>
<th>Management Serveices &amp; Utilities</th>
<th>系统管理和控制工具</th>
</tr>
</thead>
<tbody><tr>
<td>SQL Interface:</td>
<td>SQL接口。接受用户的SQL命令，并且返回用户需要查询的结果。比如select from就是调用SQL Interface</td>
</tr>
<tr>
<td>Parser</td>
<td>解析器。 SQL命令传递到解析器的时候会被解析器验证和解析</td>
</tr>
<tr>
<td>Optimizer</td>
<td>查询优化器。  SQL语句在查询之前会使用查询优化器对查询进行优化，比如有where条件时，优化器来决定先投影还是先过滤。</td>
</tr>
<tr>
<td>Cache和Buffer</td>
<td>查询缓存。如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key缓存，权限缓存等</td>
</tr>
</tbody></table>
</li>
<li><p>引擎层：存储引擎层，存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API与存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的实际需求进行选取。</p>
</li>
<li><p>存储层：数据存储层，主要是将数据存储在运行与裸设备的文件系统之上，并完成与存储引擎的交互。</p>
</li>
</ul>
<h2 id="大致的查询流程"><a href="#大致的查询流程" class="headerlink" title="大致的查询流程"></a>大致的查询流程</h2><ul>
<li>MySQL客户端通过协议与MySQL服务器建立连接，发送查询语句，先检查缓存，如果命中直接返回结果。</li>
<li>语法解析器和预处理：首先MySQL通过关键字将SQL语句进行解析，并生成一颗对应的“解析树”。MySQL解析器使用MySQL语法规则验证和解析查询，预处理器则根据一些MySQL规则进一步检查解析树是否合法。</li>
<li>查询优化器当解析树被认为是合法的了，并且由优化器将其转化成执行计划。一条查询可以有很多种执行方式，最后都返回相同的结果。查询优化器会找出其中最好的执行计划。</li>
<li>MySQL使用默认的B+树索引</li>
</ul>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><ul>
<li><p>InnoDB:默认使用</p>
<ul>
<li>InnoDB自增主键：InnoDB表如果没有指定主键，InnoDB会自动从表中选择合适的字段作为主键，如果没有合适的字段，InnoDB会创建一个不可见的，长度为6个字节的row_id。InnoDB维护了一个全局的dict_sys.row_id值，所有无主键的InnoDB表，每插入一行数据，都将当前的dict_sys.row_id值作为要插入数据的row_id，然后把dict_sys.row_id的值加1。</li>
</ul>
</li>
<li><p>MyISAM：自带系统表使用</p>
</li>
<li><p>InnoDB的数据文件自己就是索引文件。MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。</p>
</li>
<li><p>由于InnoDB的数据文件自己要按主键汇集，因此InnoDB要求必须有主键（MyISAM能够没有），若是没有显示指定，则MySQL系统会自动选择一个能够唯一标识数据记录的列作为主键，若不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整型。</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>外键</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>事务</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>行表锁</td>
<td>表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作</td>
<td>行锁,操作时只锁某一行，不对其它行有影响，,<font color=red>适合高并发的操作</font></td>
</tr>
<tr>
<td>缓存</td>
<td>只缓存索引，不缓存真实数据</td>
<td>不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响</td>
</tr>
<tr>
<td>关注点</td>
<td>节省资源、消耗少、简单业务</td>
<td>并发写、事务、更大资源</td>
</tr>
<tr>
<td>默认安装</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>默认使用</td>
<td>N</td>
<td>Y</td>
</tr>
<tr>
<td>自带系统表使用</td>
<td>Y</td>
<td>N</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><ul>
<li><p>创建索引的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sqlite">--直接创建索引<br>create index index_name on table (column(length))<br>--修改表结构的方式添加索引<br>alter table table_name add index index_name on (column(length))<br>--创建表的时候同时创建索引<br>CREATE TABLE `table` (<br>	`id` int(11) NOT NULL AUTO_INCREMENT ,<br>	`title` char(255) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL ,<br>	`content` text CHARACTER SET utf8 COLLATE utf8_general_ci NULL ,<br>	`time` int(10) NULL DEFAULT NULL ,<br>	PRIMARY KEY (`id`),<br>	INDEX index_name (title(length))<br>)<br>-- 删除索引<br>ALTER TABLE table_name DROP INDEX index_name<br>DROP INDEX index_name ON table_name<br></code></pre></td></tr></table></figure>


</li>
<li><p>Btree索引：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/4qdvuQ"><img src="https://z3.ax1x.com/2021/10/03/4qdvuQ.png" srcset="/img/loading.gif" lazyload alt="4qdvuQ.png"></a></p>
<ul>
<li>查找过程：<ul>
<li>如果要查找数据项29，那么首先会把磁盘块1由磁盘加载到内存，此时发生一次IO，在内存中用二分查找确定29在17和35之间，锁定磁盘块1的P2指针，内存时间因为非常短（相比磁盘的IO）可以忽略不计，通过磁盘块1的P2指针的磁盘地址把磁盘块3由磁盘加载到内存，发生第二次IO，29在26和30之间，锁定磁盘块3的P2指针，通过指针加载磁盘块8到内存，发生第三次IO，同时内存中做二分查找找到29，结束查询，总计三次IO。</li>
</ul>
</li>
</ul>
</li>
<li><p>B+tree索引：MySQL默认索引</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/4qwF3T"><img src="https://z3.ax1x.com/2021/10/03/4qwF3T.png" srcset="/img/loading.gif" lazyload alt="4qwF3T.png"></a></p>
</li>
<li><p>b树和b+树的区别：</p>
<ul>
<li>b树索引，关键字，记录是放在一起的。b+树的非叶子节点只有指向下一个节点的索引和关键字，记录只存放在叶子节点中。</li>
<li>b树中越靠近根节点的记录查的越快。而b+树每个记录的查找时间都是一样的，都需要从根节点走到叶子节点，并在叶子节点中查找关键字。</li>
<li>b+树的性能更好。因为b+树的非叶子节点不存放实际的数据，因此可以容纳的元素的更多，同样的数据下，树高比b树小，这样带来的好处是减少磁盘访问次数（例如，同样的数据量，b树三层，b+树两层，这样的话b+树就少一次IO操作，会快很多）。尽管B+树找到一个记录所需的比较次数要比b树多，但是一次磁盘访问的时间远远比内存比较的时间长。实际中，b+树的性能更好一些，而且b+树的叶子节点使用指针连接在一起，方便顺序遍历（例如查看一个目录下的所有文件，一个表中的所有记录等），这也是很多数据库和文件系统使用b+树的缘故。</li>
</ul>
</li>
<li><p>为什么B+树更适合在实际应用中做操作系统的文件索引和数据库索引？</p>
<ul>
<li>b+树的磁盘读写代价更低</li>
<li>b+树的查询效率更稳定。每个数据的查询效率相当。</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>C&#x2F;S 架构</li>
<li>服务器程序是 mysqld.exe</li>
<li>客户端程序是 mysql.exe</li>
<li>cmd的打开方式：</li>
</ul>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">mysql -uroot -p123456 -h127.0.0.1 -P3306<br>长选项：<br>mysql <span class="hljs-attribute">--host</span>=主机地址 <span class="hljs-attribute">--port</span>=端口 <span class="hljs-attribute">--user</span>=用户名 <span class="hljs-attribute">--password</span>=密码 默认数据库<br></code></pre></td></tr></table></figure>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><blockquote>
<ul>
<li>查看服务器中的所有数据库</li>
</ul>
</blockquote>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">show databases<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>创建新的数据库</li>
<li>数据库以目录的形式保存在服务器<br>安装目录&#x2F;data目录下</li>
</ul>
</blockquote>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">show databases<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>切换当前工作数据库<br>mysql&gt; use company;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>查看当前数据库中的所有表<br>show tables;</li>
<li>跨库查看表<br>show tables from 其他库</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>把.sql文件中数据导入数据库<br>source e:sql&#x2F;company.sql;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>查看表中的所有数据<br>select * from employees;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>创建world数据库, 并导入 world.sql , 查看表中的数据</li>
<li>create database world;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>use world;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>source d:&#x2F;mywork&#x2F;mysql&#x2F;world.sql;</li>
<li>查看当前数据库<br>select database();</li>
<li>创建表</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> customer(<br>	id <span class="hljs-type">int</span>,<br>	<span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	age <span class="hljs-type">int</span>,<br>	email <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>),<br>	gender enum(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>)<br>);<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>丢弃表<br>drop table customer;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>查看表结构<br>describe customer;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>desc 表名</li>
<li>查看表的建表语句<br>show create table 表名;</li>
<li>插入数据</li>
<li>存储引擎 : InnoDB(支持事务, 外键等高级特性), MyISAM(不支持事务, 不支持外键)</li>
<li>show engines;显示支持的引擎</li>
<li>&#96;&#96;号专门用于包围数据库对象的名称(数据库, 表, 列, 主键, 外键, 索引, 函数, 存储过程, 触发器)<br>查询表中的所有数据</li>
<li>select * from 表名; from关键字可以省略</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">插入数据<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> customer(<br>	id,<br>	<span class="hljs-type">name</span>,<br>	age,<br>	email,<br>	gender <br>) <span class="hljs-keyword">values</span> (<br>	<span class="hljs-number">1</span>,<br>	<span class="hljs-string">&#x27;张三&#x27;</span>,<br>	<span class="hljs-number">30</span>,<br>	<span class="hljs-string">&#x27;zhang3@qq.com&#x27;</span>,<br>	<span class="hljs-string">&#x27;男&#x27;</span><br>);<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>修改数据, 如果没有where 语句会导致修改所有记录</li>
</ul>
</blockquote>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gams">update customer <span class="hljs-keyword">set</span> <br>	age <span class="hljs-comment">= 3,</span><br>	email <span class="hljs-comment">=</span> <span class="hljs-comment">&#x27;QQQ&#x27;</span><br>where <br>	id <span class="hljs-comment">= 1</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>删除数据, 如果没有where语句会导致删除所有记录</li>
</ul>
</blockquote>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">delete <span class="hljs-keyword">from</span> customer<br><span class="hljs-keyword">where</span> <span class="hljs-built_in">id</span> = <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>针对数据的操作.</li>
</ul>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">C <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span>  //<span class="hljs-keyword">Create</span> <br>R <span class="hljs-keyword">select</span> 		//Retrieve<br>U <span class="hljs-keyword">update</span> 		//<span class="hljs-keyword">Update</span><br>D <span class="hljs-keyword">delete</span> 		//<span class="hljs-keyword">Delete</span><br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>查看表结构 :<br>desc 表名;</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>SQL注意 :<blockquote>
<ul>
<li>SQL 语言大小写不敏感。 </li>
<li>SQL 可以写在一行或者多行</li>
<li>关键字不能被缩写也不能分行</li>
<li>各子句一般要分行写。</li>
<li>使用缩进提高语句的可读性。</li>
</ul>
</blockquote>
</li>
<li>给列起别名, 可以省略as关键字, 别名中如果有特殊符号, 可以使用””包围.</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <br>	population <span class="hljs-keyword">as</span> pop,<br>	<span class="hljs-type">name</span> &quot;国家 名称&quot;,<br>	code<br><span class="hljs-keyword">from</span> <br>	country;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>where 条件布尔(一个表达式，返回结果永远是一个布尔值)</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>执行顺序SQL：先from, 再where 最后select</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> <br>	employee_id empId, <br>	last_name <span class="hljs-type">name</span>, <br>	job_id job, <br>	department_id deptId<br><span class="hljs-keyword">FROM</span>   <br>	employees<br><span class="hljs-keyword">WHERE</span>  <br>	department_id = <span class="hljs-number">90</span> ;<br>	<br><span class="hljs-comment">-- 错误!! where中不可以使用列的别名, 因为此时虚表的列还没有生成好.</span><br></code></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Between a and b 都包含</li>
<li>like <blockquote>
<ul>
<li>% 表示任意个任意字符</li>
<li>_ 表示一个任意字符</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">查询姓名中第2个字母是o其他无所谓<br><span class="hljs-keyword">SELECT</span> last_name<br><span class="hljs-keyword">FROM</span>   employees<br><span class="hljs-keyword">WHERE</span>  last_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;_o%&#x27;</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>只要有null参与比较运算, 结果一定是false</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">查询哪些国家没有首都<br>只要有<span class="hljs-keyword">null</span>参与比较运算, 结果一定是<span class="hljs-keyword">false</span><br><span class="hljs-comment">--错误!!</span><br><span class="hljs-keyword">select</span> <br>	<span class="hljs-type">name</span>,<br>	continent,<br>	capital<br><span class="hljs-keyword">from</span> <br>	country <br><span class="hljs-keyword">where</span> <br>	capital = <span class="hljs-keyword">null</span>;<br>	<br>查询哪些国家没有首都<br><span class="hljs-keyword">select</span> <br>	<span class="hljs-type">name</span>,<br>	continent,<br>	capital<br><span class="hljs-keyword">from</span> <br>	country <br><span class="hljs-keyword">where</span> <br>	capital <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br><br>查询哪些国家有首都<br><span class="hljs-keyword">select</span> <br>	<span class="hljs-type">name</span>,<br>	continent,<br>	capital<br><span class="hljs-keyword">from</span> <br>	country <br><span class="hljs-keyword">where</span> <br>	capital <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>where 也支持算术运算, 结果为0表示假非0表示真</li>
<li>distinct 去重, 要求列真的有重复的</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span><br>	<span class="hljs-keyword">distinct</span><br>		continent,<br>		<span class="hljs-type">name</span><br><span class="hljs-keyword">from</span><br>	country;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>order by  可以排序, 只是给结果集虚表排序</li>
<li>默认是升充(asc)	</li>
<li>降序必须指定(desc)</li>
<li>order by 可以使用列的别名.</li>
<li>order by  列1, 列2 先以列1排序, 再在相同的列1数据中, 再依据列2再微排.</li>
</ul>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> <br>	last_name, <br>	department_id, <br>	salary<br><span class="hljs-keyword">FROM</span>   <br>	employees<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <br>	department_id, <br>	salary <span class="hljs-keyword">DESC</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>写SQL的步骤 : <blockquote>
<ul>
<li>(1) from 基表</li>
<li>(2) where 过滤哪些行</li>
<li>(3) select 选择哪些列</li>
<li>(4) order by 以哪些列为排序依据.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="表联接"><a href="#表联接" class="headerlink" title="表联接"></a>表联接</h3><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs axapta">表联接<br><span class="hljs-keyword">select</span> <br>	* <br><span class="hljs-keyword">from</span> <br>	city2,<br>	country2;<br>笛卡尔集中的数据绝大多数都是垃圾, 必须使用行过滤.<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>笛卡尔集中的数据绝大多数都是垃圾, 必须使用行过滤.</li>
<li>解决列名冲突可以使用表名限定</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">--表名也可以起别名, 而且是如果多表联接, 最好起别名.</span><br><span class="hljs-keyword">select</span> <br>	ci.name cityName,<br>	ci.population cityPop,<br>	co.name countryName,<br>	co.population countryPop,<br>	co.continent<br><span class="hljs-keyword">from</span> <br>	city2 ci,<br>	country2 co <br><span class="hljs-keyword">where</span> <br>	ci.countrycode = co.code;<br>	<br><span class="hljs-comment">--一旦给表起了别名, 原名不可以使用, 必须使用别名. 原因是from最先执行, 它把原始表名变了.</span><br><span class="hljs-keyword">select</span> <br>	city2.name cityName,<br>	city2.population cityPop,<br>	country2.name countryName,<br>	country2.population countryPop,<br>	country2.continent<br><span class="hljs-keyword">from</span> <br>	city2 ci,<br>	country2 co <br><span class="hljs-keyword">where</span> <br>	city2.countrycode = country2.code;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>复习 :<blockquote>
<ul>
<li>C&#x2F;S </li>
<li>Server : mysqld.exe </li>
<li>Clinet : mysql.exe </li>
<li>必须通过客户端才能使用服务器</li>
<li>需要提供IP, 端口, 用户名, 密码.</li>
<li>mysql -h127.0.0.1 -P3306 -uroot -p123456</li>
<li>mysql –host&#x3D;127.0.0.1 –port&#x3D;3306 –user&#x3D;root –password&#x3D;123456 默认数据库</li>
<li>mysql –host&#x3D;主机地址 –port&#x3D;端口 –user&#x3D;用户名 –password&#x3D;密码 默认数据库</li>
<li>查看所有库<br>show databases;</li>
<li>切换成当前工作数据库<br>use 数据库;</li>
<li>查看库中的表<br>show tables;</li>
<li>跨库查看表<br>show tables from 其他库</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>查看表结构<br>desc 表名;</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>查看表的建表语句<br>show create table 表名;</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>存储引擎 : InnoDB(支持事务, 外键等高级特性), MyISAM(不支持事务, 不支持外键)</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>&#96;&#96;专门用于包围数据库对象的名称(数据库, 表, 列, 主键, 外键, 索引, 函数, 存储过程, 触发器)</li>
<li>查询表中的所有数据<br>select * from 表名; from关键字可以省略</li>
</ul>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ul>
<li>相看当前数据库<br>select<br>  database(), – 函数<br>  now(),<br>  version()</li>
</ul>
</blockquote>
</blockquote>
<p>select<br>    100, – 常量<br>    ‘abc’<br>from<br>    dual;</p>
<blockquote>
<blockquote>
<ul>
<li>使用用户变量<br>set @var1 &#x3D; 100, @var2 &#x3D; ‘abc’;</li>
</ul>
</blockquote>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-comment">--SQL99标准, 用内联代替逗号联接.</span><br><span class="hljs-keyword">select</span> <br>	ci.name cityName,<br>	ci.population cityPop,<br>	co.name countryName,<br>	co.population countryPop,<br>	co.continent<br><span class="hljs-keyword">from</span> <br>	city2 ci<br><span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> <br>	country2 co <br><span class="hljs-keyword">on</span><br>	ci.countrycode = co.code <span class="hljs-comment">-- 联接条件</span><br><span class="hljs-keyword">where</span>  <br>	ci.population &gt; <span class="hljs-number">5000000</span> <span class="hljs-comment">-- 普通过滤</span><br>	<br><br><span class="hljs-comment">-- where 和 on在内联时可以混用, 但是千万不要.</span><br><span class="hljs-keyword">select</span> <br>	ci.name cityName,<br>	ci.population cityPop,<br>	co.name countryName,<br>	co.population countryPop,<br>	co.continent<br><span class="hljs-keyword">from</span> <br>	city2 ci<br><span class="hljs-keyword">join</span> <br>	country2 co <br><span class="hljs-keyword">on</span><br>	ci.countrycode = co.code <span class="hljs-comment">-- 联接条件</span><br><span class="hljs-keyword">where</span>  <br>	ci.population &gt; <span class="hljs-number">5000000</span> <span class="hljs-comment">-- 普通过滤</span><br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>注意：<blockquote>
<ul>
<li>内联接的逻辑是从笛尔集中取出来的是满足联接条件的记录. 有可能会导致某张表的数据不完整.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <br>	co.name countryName,<br>	ci.name capitalName,<br>	co.capital<br><span class="hljs-keyword">from</span> <br>	country2 co <br><span class="hljs-keyword">left outer join</span> <span class="hljs-comment">-- 左外联接, 保证左表数据完整</span><br>	city2 ci <br><span class="hljs-keyword">on</span> <br>	co.capital = ci.id ;<br>	<br><span class="hljs-keyword">select</span> <br>	co.name countryName,<br>	ci.name capitalName,<br>	co.capital<br><span class="hljs-keyword">from</span> <br>	country2 co <br><span class="hljs-keyword">right outer join</span> <span class="hljs-comment">-- 左外联接, 保证左表数据完整</span><br>	city2 ci <br><span class="hljs-keyword">on</span> <br>	co.capital = ci.id ;<br>	<br><span class="hljs-comment">--外联时可以省略outer关键字	</span><br><span class="hljs-keyword">select</span> <br>	co.name countryName,<br>	ci.name capitalName,<br>	co.capital<br><span class="hljs-keyword">from</span> <br>	country2 co <br><span class="hljs-keyword">left join</span><br>	city2 ci <br><span class="hljs-keyword">on</span> <br>	co.capital = ci.id ;<br></code></pre></td></tr></table></figure>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><h4 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h4><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">单行函数 -- 作用于结果集中的每一条记录的.<br><span class="hljs-keyword">select</span> <br>	upper(name),<br>	now(),<br>	<span class="hljs-keyword">concat</span>(continent, code2)<br><span class="hljs-keyword">from</span> <br>	country<span class="hljs-punctuation">;</span><br>	<br>查询国家表中的数据, 把国家名称,大洲, 国家代码 连接起来, 中间使用<span class="hljs-string">&#x27;=&gt;&#x27;</span>连接.<br>--<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">concat</span>(<span class="hljs-keyword">concat</span>(name, <span class="hljs-string">&#x27;=&gt;&#x27;</span>), continent), <span class="hljs-string">&#x27;=&gt;&#x27;</span>), code)<br><span class="hljs-keyword">select</span> <br>	<span class="hljs-keyword">concat</span>(name, <span class="hljs-string">&#x27;=&gt;&#x27;</span>, continent, <span class="hljs-string">&#x27;=&gt;&#x27;</span>, code)<br><span class="hljs-keyword">from</span> <br>	country<span class="hljs-punctuation">;</span><br></code></pre></td></tr></table></figure>
<h4 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">组函数（聚合函数） -- 作用于一组数据, 最终针对一组只有一个结果. 也称为统计处理<br><span class="hljs-function"><span class="hljs-title">avg</span><span class="hljs-params">()</span></span> 平均<br><span class="hljs-function"><span class="hljs-title">max</span><span class="hljs-params">()</span></span> 最大<br><span class="hljs-function"><span class="hljs-title">min</span><span class="hljs-params">()</span></span> 最小<br><span class="hljs-function"><span class="hljs-title">count</span><span class="hljs-params">()</span></span> 计数<br><span class="hljs-function"><span class="hljs-title">sum</span><span class="hljs-params">()</span></span>求和<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>获取表中的记录数, 使用count(*)最好.</li>
<li>如果有group by , 必须让分组依据的列放在select中.</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <br>	<span class="hljs-comment">-- name, 代表个体信息的列</span><br>	continent,<br>	max(population)<br><span class="hljs-keyword">from</span> <br>	country <br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <br>	continent;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>对分组的虚表进行过滤, 必须使用having</li>
<li>having的执行晚于select, 所以可以使用列的别名</li>
</ul>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <br>	GovernmentForm,<br>	<span class="hljs-built_in">count</span>(*) ct<br><span class="hljs-keyword">from</span> <br>	country<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <br>	GovernmentForm<br><span class="hljs-keyword">having</span><br>	ct &gt; <span class="hljs-number">10</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <br>	ct;<br></code></pre></td></tr></table></figure>
<p>sql语句一般的执行顺序：</p>
<ol>
<li>from 		确定基表</li>
<li>join 		如果一张基表不够, 再联接其他表</li>
<li>on 			如果有联接表 必须要有on</li>
<li>where 		过滤总基表中的行</li>
<li>group by 	分组, 分组依据的列.</li>
<li>select 		把分组依据的列放在select后, 再考虑要选择哪些列, 及进行哪些函数调用….</li>
<li>having 		进一步把分组后的虚表行过滤</li>
<li>order by 	最终表的一个排序显示.</li>
</ol>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><blockquote>
<ul>
<li>子查询 : 通常需要多步执行的简单查询</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>针对表中的数据进行的操作, 这样的语言称DML(数据操纵语句)<blockquote>
<ul>
<li>select R</li>
<li>update U </li>
<li>delete D </li>
<li>insert C</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>针对数据库中的对象的操作, 这样的语言称DDL(数据定义语言)</li>
<li>数据库 </li>
<li>表</li>
<li>列 </li>
<li>约束 </li>
<li>索引 </li>
<li>预编译</li>
<li>函数</li>
<li>存储过程 </li>
<li>触发器</li>
<li>事件…..</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">创建数据库 <br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> 数据库名 charset 字符集;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> school charset utf8;<br><br>修改数据库 <br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">database</span> school charset gbk;<br><br>丢弃数据库. 数据库中的所有内容全部丢弃. 慎重!!!!<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> school;<br><br>常用数据类型<br><span class="hljs-type">int</span> 			<span class="hljs-number">4</span>字节整数<br><span class="hljs-type">bigint</span>			<span class="hljs-number">8</span>字节整数<br><span class="hljs-type">char</span>(长度)		定长字符串<br><span class="hljs-type">varchar</span>(字符数) // 最多<span class="hljs-number">65535</span>字节<br><span class="hljs-type">double</span>			<span class="hljs-number">8</span>字节双精度浮点<br><span class="hljs-type">decimal</span>			定点数<br><span class="hljs-type">date</span> 			日期<br>datetime		日期时间<br>longtext 		长文本<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> teacher(<br>	id <span class="hljs-type">int</span> auto_increment,<br>	<span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	age <span class="hljs-type">int</span>,<br>	phone <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	address <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>),<br>	gender enum(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;男&#x27;</span>,<br>	<span class="hljs-keyword">primary key</span>(id)<br>) engine innodb charset gbk;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> classes(<br>	id <span class="hljs-type">int</span> auto_increment,<br>	<span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>),<br>	student_count <span class="hljs-type">int</span>,<br>	room <span class="hljs-type">char</span>(<span class="hljs-number">3</span>),<br>	master <span class="hljs-type">int</span>, <span class="hljs-comment">-- 班主任</span><br>	begindate <span class="hljs-type">date</span>,<br>	<span class="hljs-keyword">primary key</span>(id)<br>);<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>子查询题目例子</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">5</span> 查询所有国家的首都和使用率最高的官方语言(选做)<br><span class="hljs-keyword">select</span> <br>	co.name,<br>	ci.name,<br>	cl3.<span class="hljs-keyword">language</span>,<br>	cl3.percentage<br><span class="hljs-keyword">from</span> <br>	country co <br><span class="hljs-keyword">left join</span> <br>	city ci <br><span class="hljs-keyword">on</span> <br>	co.capital = ci.id <br><span class="hljs-keyword">left join</span> <br>	(<span class="hljs-keyword">select</span> <br>		cl.countrycode,<br>		cl.<span class="hljs-keyword">language</span>,<br>		cl.percentage,<br>		cl.isofficial<br>	<span class="hljs-keyword">from</span> <br>		countrylanguage cl <br>	<span class="hljs-keyword">join</span>  <br>		(<span class="hljs-keyword">select</span> countrycode, max(Percentage) maxPer <span class="hljs-keyword">from</span> countrylanguage <span class="hljs-keyword">where</span> isofficial = <span class="hljs-string">&#x27;T&#x27;</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> countrycode) cl2<br>	<span class="hljs-keyword">on</span> <br>			cl.countrycode = cl2.countrycode <br>		<span class="hljs-keyword">and</span> <br>			cl.percentage = cl2.maxPer<br>	<span class="hljs-keyword">where</span> <br>		cl.isofficial = <span class="hljs-string">&#x27;T&#x27;</span><br>	) cl3<br><span class="hljs-keyword">on</span> <br>	co.code = cl3.countrycode <br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <br>	cl3.percentage;<br></code></pre></td></tr></table></figure>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">创建数据库 <br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> 数据库名 charset utf8;<br><br>修改数据库 只能修改字符集<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">database</span> 数据库名 charset 新字符集;<br><br>丢弃数据库<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> 数据加名;<br><br>查看库或表<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span>(<span class="hljs-keyword">table</span>) 数据库名或表名<br><br><span class="hljs-keyword">SQL</span>语言分类<br>	<span class="hljs-number">1</span>) DML 数据操纵语言, 主要处理数据<br>		<span class="hljs-keyword">insert</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">update</span> <span class="hljs-keyword">delete</span> <br>		<br>	<span class="hljs-number">2</span>) DDL 数据定义语言, 主要处理数据库对象<br>		<span class="hljs-keyword">create</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">drop</span> <br>		<br>	<span class="hljs-number">3</span>) DCL 数据控制语句, 主要用于控制事务<br>		<span class="hljs-keyword">commit</span> <span class="hljs-keyword">rollback</span><br><br></code></pre></td></tr></table></figure>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><blockquote>
<ul>
<li>全新方式创建表</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span>) 全新方式建表<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> 表名(<br>	列<span class="hljs-number">1</span> 数据类型<span class="hljs-number">1</span>(长度) 其他选项,<br>	列<span class="hljs-number">2</span> 数据类型<span class="hljs-number">2</span>(长度) 其他选项,<br>	......,<br>	<span class="hljs-keyword">primary</span> key(列) <span class="hljs-comment">-- 表级主键</span><br>) engine 数据库引擎 charset 字符集;<br><br>数据库引擎 : <br>	InnoDB : 缺省引擎, 支持事务, 外键等高级特性, 速度慢<br>	MyIsam : 速度快, 早期的缺省引擎, 不支持事务,外键等高级特性<br><br>其他选项 : auto_increment, <span class="hljs-keyword">default</span> 缺省值, <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, unique.<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>基于子查询, 可以复制数据，不能复制各种约束（key）…</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> 表名 <br>子查询 <br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> country3 <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> world.country <span class="hljs-keyword">where</span> continent <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;asia&#x27;</span>;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> country4 <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> world.country;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>完全复制表结构，不能复制数据</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> 表名 <span class="hljs-keyword">like</span> 已有表名<br></code></pre></td></tr></table></figure>
<h3 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs sql">表结构的修改<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <br><span class="hljs-comment">--子句</span><br><br>添加新列<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <br><span class="hljs-keyword">add</span> 新列名 数据类型 其他选项;<br><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> teacher <br><span class="hljs-keyword">add</span> gender enum(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;男&#x27;</span>;<br><br>修改列<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <br>modify 列名 新数据类型 新其他选项;<br><br>修改列名<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名 <br>change 老列名 新列名 新数据类型 新其他选项;<br>丢弃一个列, 此列对应的所有数据都会删除<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">column</span> 列名 <br><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> teacher<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">column</span> address;<br>丢弃表 <br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> 表名<span class="hljs-number">1</span>, 表名<span class="hljs-number">2</span>, ....;<br><br>清空表数据<br><span class="hljs-keyword">truncate</span> <span class="hljs-keyword">table</span> 表名; <span class="hljs-comment">-- 它是一个DDL语句, 一旦清除,就不能回滚, 效率高.</span><br><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> 表名; <span class="hljs-comment">-- 它是一个DML语句, 意味着是可以回滚的. 效率低.</span><br><br>修改表名<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br>rename <span class="hljs-keyword">to</span> 新表名<br></code></pre></td></tr></table></figure>
<h3 id="插入数据的方式"><a href="#插入数据的方式" class="headerlink" title="插入数据的方式"></a>插入数据的方式</h3><ol>
<li>全新方式插入<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs lasso">insert <span class="hljs-keyword">into</span> 表名 (<br>	列<span class="hljs-number">1</span>,<br>	列<span class="hljs-number">2</span>,<br>	列<span class="hljs-number">3</span>,<br>	<span class="hljs-params">...</span>..<br>) values (<br>	值<span class="hljs-number">1</span>,<br>	值<span class="hljs-number">2</span>,<br>	值<span class="hljs-number">3</span>,<br>	<span class="hljs-params">...</span>.<br>)<br></code></pre></td></tr></table></figure></li>
<li>使用子查询插入<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> students(<br>	<span class="hljs-type">name</span>,<br>	age,<br>	mobile,<br>	gender,<br>	address<br>) <span class="hljs-keyword">select</span> <br>	<span class="hljs-type">name</span>,<br>	age, <br>	mobile,<br>	gender,<br>	<span class="hljs-string">&#x27;北京&#x27;</span><br><span class="hljs-keyword">from</span> <br>	teachers <br><span class="hljs-keyword">where</span> <br>	id <span class="hljs-keyword">in</span> (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br><span class="hljs-comment">-- 克隆表</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> 新表 <span class="hljs-keyword">like</span> 旧表;<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> 新表 <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> 旧表 <br>克隆城市表到当前库下新成中国城市表 (chinaCity)<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> chinaCity <span class="hljs-keyword">like</span> world.city; <br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> chinacity <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> world.city <span class="hljs-keyword">where</span> countrycode = <span class="hljs-string">&#x27;chn&#x27;</span>;<br></code></pre></td></tr></table></figure></li>
<li>插入一条数据 insert into 表名 set 数据<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <br>	teachers <br><span class="hljs-keyword">set</span> <br>	name = <span class="hljs-string">&#x27;丁老师&#x27;</span>,<br>	age = <span class="hljs-number">25</span>,<br>	mobile = <span class="hljs-string">&#x27;123234234&#x27;</span>;<br>修改数据 <br><span class="hljs-keyword">update</span> 表名 <span class="hljs-keyword">set</span> <br>	列<span class="hljs-number">1</span> = 值<span class="hljs-number">1</span>,<br>	列<span class="hljs-number">2</span> = 值<span class="hljs-number">2</span>,<br>	列<span class="hljs-number">3</span> = 值<span class="hljs-number">3</span>,<br>	....<br><span class="hljs-keyword">where</span> <br>	行过滤<br>	<br><span class="hljs-keyword">update</span> teachers <span class="hljs-keyword">set</span> <br>	age = <span class="hljs-number">40</span>,<br>	mobile = <span class="hljs-string">&#x27;135342342&#x27;</span><br><span class="hljs-keyword">where</span> <br>	id = <span class="hljs-number">1</span>;<br>	<br>删除数据 <br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> 表名 <br><span class="hljs-keyword">where</span> 行过滤<br><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> teachers <br><span class="hljs-keyword">where</span> id &gt; <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h3 id="数据库事物"><a href="#数据库事物" class="headerlink" title="数据库事物"></a>数据库事物</h3><blockquote>
<ul>
<li>定义：让数据从一种状态到另一种状态</li>
<li>ACID特性</li>
<li>让一组逻辑操作单元当成一个单个的命令来执行.<blockquote>
<ul>
<li>A 原子性 : 不可分割 </li>
<li>C 一致性 : 数据前后是一致</li>
<li>I 独立性 : 事务间, (独立性有等级)</li>
<li>D 持久性 : 事务一旦提交, 数据持久化.</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">设置提交状态：<span class="hljs-keyword">SET</span> AUTOCOMMIT = <span class="hljs-keyword">FALSE</span>;<br>或者显式的执行 <span class="hljs-keyword">start</span> <span class="hljs-keyword">transaction</span><br>            或 <span class="hljs-keyword">begin</span><br>			<br>以第一个 DML 语句的执行作为开始<br><br>以下面的其中之一作为结束:<br><span class="hljs-keyword">COMMIT</span> 或 <span class="hljs-keyword">ROLLBACK</span> 语句<br>DDL 语句（自动提交）<br>用户会话正常结束, 提交<br>系统异常终止      回滚<br><br><span class="hljs-keyword">SET</span> AUTOCOMMIT = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-keyword">set</span> autocommit = <span class="hljs-keyword">false</span>;<br><br>用一个客户端在事务中删除表数据, 另一个客户端查询??<br><br>预编译 : 提前把<span class="hljs-keyword">SQL</span>编译成可执行的, 在执行时只需要调用它即可.<br><span class="hljs-keyword">prepare</span> 预编译名 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;SQL&#x27;</span>; <br><br><span class="hljs-keyword">prepare</span> p1 <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;select * from teachers&#x27;</span><br><br>执行预编译 <br><span class="hljs-keyword">execute</span> p1; <br><br>丢弃预编译<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">prepare</span> p1;<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">prepare</span> p2 <br><span class="hljs-keyword">from</span> <br>	<span class="hljs-string">&#x27;insert into teachers(</span><br><span class="hljs-string">		name, </span><br><span class="hljs-string">		age, </span><br><span class="hljs-string">		mobile</span><br><span class="hljs-string">	) values (</span><br><span class="hljs-string">		?,</span><br><span class="hljs-string">		?,</span><br><span class="hljs-string">		?</span><br><span class="hljs-string">	)&#x27;</span>;<br>	<br><span class="hljs-keyword">prepare</span> p3 <span class="hljs-keyword">from</span> <br><span class="hljs-string">&#x27;delete from teachers </span><br><span class="hljs-string"> where id = ?&#x27;</span>;<br><br>在执行时预编译时, 代替?的实参必须要用用户变量<br><br><span class="hljs-keyword">set</span> @变量名 <span class="hljs-operator">=</span> 值, @变量名<span class="hljs-number">2</span> <span class="hljs-operator">=</span> 值<span class="hljs-number">2</span>;<br><br><span class="hljs-keyword">execute</span> 预编译 <span class="hljs-keyword">using</span> @变量名, @变量名<span class="hljs-number">2</span>;<br><br>? 只能代替值的部分, 表名, 列名绝不可以.<br>下面是错误<span class="hljs-operator">!</span><span class="hljs-operator">!</span><br><span class="hljs-keyword">prepare</span> p4 <span class="hljs-keyword">from</span> <br><span class="hljs-string">&#x27;insert into teachers(</span><br><span class="hljs-string">	?, </span><br><span class="hljs-string">	?, </span><br><span class="hljs-string">	?</span><br><span class="hljs-string">) values (</span><br><span class="hljs-string">	?,</span><br><span class="hljs-string">	?,</span><br><span class="hljs-string">	?</span><br><span class="hljs-string">)&#x27;</span>;<br><br>在<span class="hljs-keyword">SQL</span>中要想使用<span class="hljs-string">&#x27;, 必须再加一个&#x27;</span>, 起到转义的作用<br><span class="hljs-keyword">prepare</span> p2 <span class="hljs-keyword">from</span> <br><span class="hljs-string">&#x27;insert into teachers(</span><br><span class="hljs-string">	name, </span><br><span class="hljs-string">	age, </span><br><span class="hljs-string">	mobile,</span><br><span class="hljs-string">	gender</span><br><span class="hljs-string">) values (</span><br><span class="hljs-string">	?,</span><br><span class="hljs-string">	?,</span><br><span class="hljs-string">	?,</span><br><span class="hljs-string">	?</span><br><span class="hljs-string">)&#x27;</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>有以下六种约束:<blockquote>
<ul>
<li>NOT NULL 非空约束，规定某个字段不能为空, 必须列级约束 </li>
<li>UNIQUE  唯一约束，规定某个字段在整个表中是唯一的</li>
<li>PRIMARY KEY  主键(非空且唯一)</li>
<li>FOREIGN KEY  外键</li>
<li>DEFAULT  默认值, 必须是列级</li>
<li>check</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test(<br>	id <span class="hljs-type">int</span> auto_increment,<br>	<span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	phone <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, <span class="hljs-comment">-- 必须列级约束</span><br>	<span class="hljs-keyword">unique</span>(<span class="hljs-type">name</span>), <span class="hljs-comment">-- 可以表级约束</span><br>	<span class="hljs-keyword">primary key</span>(id)<br>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> test(<br>	<span class="hljs-type">name</span>,<br>	phone<br>) <span class="hljs-keyword">values</span> (<br>	<span class="hljs-string">&#x27;aaa&#x27;</span>,<br>	<span class="hljs-string">&#x27;234234&#x27;</span><br>);<br><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> test <br><span class="hljs-keyword">drop</span> key <span class="hljs-type">name</span>; <span class="hljs-comment">-- 丢弃唯一键约束</span><br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test2(<br>	id <span class="hljs-type">int</span> auto_increment,<br>	<span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>	phone <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>, <span class="hljs-comment">-- 必须列级约束</span><br>	<span class="hljs-keyword">constraint</span> myunique <span class="hljs-keyword">unique</span>(<span class="hljs-type">name</span>, phone), <span class="hljs-comment">-- 可以表级约束, 联合键</span><br>	<span class="hljs-keyword">primary key</span>(id)<br>);<br><br></code></pre></td></tr></table></figure>
<h3 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h3><blockquote>
<ul>
<li>外键 : 让一个表中的记录的值要引用到另一张表中的数据…</li>
<li>一旦有了外键, 子表中插入数据必须要引用到真实的父表中数据</li>
<li>一旦父表中的记录被子表引用, 当删除父表中的相关记录时, 不允许删除.</li>
</ul>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">foreign key</span>(本表的外键列) <span class="hljs-keyword">references</span> 父表(父表主键)<br><br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">exists</span> classes;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> classes(<br>	id <span class="hljs-type">int</span> auto_increment,<br>	<span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>),<br>	student_count <span class="hljs-type">int</span>,<br>	room <span class="hljs-type">char</span>(<span class="hljs-number">3</span>),<br>	master <span class="hljs-type">int</span>, <br>	begindate <span class="hljs-type">date</span>,<br>	<span class="hljs-keyword">primary key</span>(id),<br>	<span class="hljs-keyword">foreign key</span>(master) <span class="hljs-keyword">references</span> teachers(id)<br>);<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>丢弃外键, 必须要知道外键名.</li>
</ul>
</blockquote>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> classes <br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> classes_ibfk_1;<br></code></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>添加外键</li>
<li>on delete do nothing, 是默认选项, 在删除父表被引用的记录时不允许</li>
<li>on delete cascade 级联删除, 当删除父表中的相关记录时, 子表中引用此记录的所有记录也会被删除.</li>
<li>on delete set null 级联置空.当删除父表中的相关记录时, 子表中引用此记录的所有记录会被置为空.</li>
</ul>
</blockquote>
<h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><blockquote>
<ul>
<li>limit n, 把结果集截断成n条记录.</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><p>limit m, n 把结果集中的m条略过, 再截断成n条记录</p>
</li>
<li><p>limit子句必须放在整个查询语句的最后！</p>
</li>
<li><p>offset n 表示去掉n个值</p>
</li>
<li><p>一般用法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span>      <span class="hljs-comment">-- 倒序</span><br>LIMIT <span class="hljs-number">1</span> <span class="hljs-keyword">offset</span> <span class="hljs-number">2</span>;       <span class="hljs-comment">-- 去掉排名倒数第一第二的时间，取倒数第三;   </span><br>        <br></code></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><blockquote>
<ul>
<li>重点：DML数据操纵语言，主要就是查询</li>
<li>标准SQL<blockquote>
<ul>
<li>select </li>
<li>from </li>
<li>left join </li>
<li>on </li>
<li>where </li>
<li>group by </li>
<li>having </li>
<li>order by</li>
</ul>
</blockquote>
</li>
<li>注意点<blockquote>
<ul>
<li>注意多表连接的内联，外联 </li>
<li>函数的使用，where中不能使用</li>
<li>别名的使用，从group by开始可以使用select中的别名了</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><ul>
<li><p>先找到运行慢的SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看慢SQL日志是否可用</span><br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;log_slow_queries&#x27;</span>;<br><br><span class="hljs-comment">-- 查看执行慢于多少秒的SQL会记录到日志文件中</span><br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;long_query_time&#x27;</span>;<br><br><span class="hljs-comment">-- 查看慢SQL存在的位置</span><br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log_file&#x27;</span>;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><ul>
<li>尽量使用 <code>TINYINT</code> 、 <code>SMALLINT</code> 、 <code>MEDIUM_INT</code> 作为整数类型而非 <code>INT</code> ，如果非负则加上 <code>UNSIGNED</code></li>
<li>varchar的长度只分配真正需要的空间</li>
<li>使用枚举或整数代替字符串类型</li>
<li>尽量使用TIMESTAMP而非DATETIME</li>
<li>单表不要有太多字段，建议在20以内</li>
<li>避免使用NULL字段，很难查询优化且占用额外索引空间</li>
<li>用整型来存IP</li>
</ul>
<h3 id="索引-1"><a href="#索引-1" class="headerlink" title="索引"></a>索引</h3><ul>
<li>索引并不是越多越好，要根据查询有针对性地创建，<font color=red>考虑在where和order by命令上涉及地列建立索引</font>，根据explain来查看是否用了索引还是全表扫描。</li>
<li>应尽量避免在where子句中对字段进行NULL值判断，否则将导致引擎放弃使用索引而进行全表扫描。</li>
<li>值分布很稀少地字段不适合建索引</li>
<li>字符串字段只建前缀索引</li>
<li>字符字段最好不要做主键</li>
<li>不用外键，由程序保证约束</li>
<li>尽量不用 <code>UNIQUE</code> ，由程序保证约束</li>
<li>使用多列索引时主意顺序和查询条件保持一致，同时删除不必要的单列索引</li>
</ul>
<h3 id="查询SQL"><a href="#查询SQL" class="headerlink" title="查询SQL"></a>查询SQL</h3><ul>
<li>可通过开启慢查询日志来找出较慢的SQL</li>
<li>不做列运算</li>
<li>sql语句尽可能简单，一条SQL只能在一个cpu运算，大语句拆小语句，减少锁时间；一条大SQL可以堵死整个库。</li>
<li>不用select *，要尽量避免使用 select *，而是查询需要的字段，这样可以提升速度，以及减少网络传输的带宽压力</li>
<li><font color=red>or改写成in</font>,or的效率是n级别，in的效率是log(n)级别，in的个数建议在200以内</li>
<li>不用函数和触发器，在应用程序实现</li>
<li>少用join</li>
<li>使用同类型进行比较</li>
<li><font color=red>尽量避免在where子句中使用!&#x3D;或&lt;&gt;操作符</font>，否则引擎将放弃使用索引而进行全表扫描。</li>
<li>对于连续型数值，使用BETWEEN 不用 in</li>
<li>列表数据不要拿全表，要使用limit来分页，每页数量也不要太大</li>
<li>小表驱动大表</li>
</ul>
<h3 id="系统参数调优"><a href="#系统参数调优" class="headerlink" title="系统参数调优"></a>系统参数调优</h3><ul>
<li>wait_timeout：数据库连接闲置时间，闲置连接会占用内存资源。可以从默认的8小时减到半小时</li>
<li>max_user_connection: 最大连接数，默认为0无上限，最好设一个合理上限</li>
<li>back_log：back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。也就是说，如果MySql的连接数据达到max_connections时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。可以从默认的50升至500</li>
<li>thread_concurrency：并发线程数，设为CPU核数的两倍</li>
</ul>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li>如果在实现用户的某些需求时，需要编写一组复杂的SQL语句才能实现的时候，那么我们就可以将这组复杂的SQL语句集提前编写在数据库中，由JDBC调用来执行这组SQL语句。把编写在数据库中的SQL语句集称为存储过程。</li>
<li>存储过程：(procedure) 是事先经过编译并存储在数据库中的一段SQL语句的集合。调用存储过程可以简化应用开发人员的很多工作，减少数据在数据库和应用服务器之间的传输，对于提高数据处理的效率是很有好处的。<font color=red><strong>存储过程就是数据库SQL语言层面的代码封装与重用</strong></font></li>
<li>存储过程就类似于Java中的方法，需要先定义，使用时需要调用。存储过程可以定义参数，参数分为IN，OUT，INOUT三种类型<ul>
<li>IN类型的参数表示接受调用者传入的数据</li>
<li>OUT类型的参数表示向调用者返回数据</li>
<li>INOUT类型的参数既可以接受调用者传入的参数，也可以向调用者返回数据</li>
</ul>
</li>
</ul>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul>
<li><p>优点</p>
<ul>
<li>简化复杂操作，简化对变动的管理</li>
<li><strong>通常存储过程有助于提高应用程序的性能</strong>。当创建的存储过程被编译之后，就存储在数据库中。</li>
<li>存储过程有助于减少应用程序和数据库服务器之间的流量。</li>
<li>可重用，透明，安全的。</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li><p>如果大量使用存储过程，那么使用这些存储过程的每个连接的内存使用量将大大增加。此外，如果在存储过程中过度使用大量的逻辑操作，那么CPU的使用率也在增加，因为MySQL数据库最初的设计就侧重于高效的查询，而不是逻辑运算。</p>
</li>
<li><p>开发维护，调试代码困难，<strong>对数据库依赖程度高，移植性较差</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $$<br><br><span class="hljs-keyword">CREATE</span><br>    <span class="hljs-comment">/*[DEFINER = &#123; user | CURRENT_USER &#125;]*/</span><br>    <span class="hljs-keyword">PROCEDURE</span> 数据库名.存储过程名([<span class="hljs-keyword">in</span>变量名 类型,<span class="hljs-keyword">out</span> 参数 <span class="hljs-number">2</span>，...])<br>    <span class="hljs-comment">/*LANGUAGE SQL</span><br><span class="hljs-comment">    | [NOT] DETERMINISTIC</span><br><span class="hljs-comment">    | &#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;</span><br><span class="hljs-comment">    | SQL SECURITY &#123; DEFINER | INVOKER &#125;</span><br><span class="hljs-comment">    | COMMENT &#x27;string&#x27;*/</span><br>	<span class="hljs-keyword">BEGIN</span><br>		[<span class="hljs-keyword">DECLARE</span> 变量名 类型 [<span class="hljs-keyword">DEFAULT</span> 值];]<br>		存储过程的语句块;<br>	<span class="hljs-keyword">END</span>$$<br><br>DELIMITER ;<br><br></code></pre></td></tr></table></figure>
</li>
<li><p>in代表输入参数（默认情况下为in参数），表示该参数的值必须由调用程序指定。</p>
</li>
<li><p>out代表输出参数，表示该参数的值经过存储过程计算后，将out参数的计算结果返回给调用程序</p>
</li>
<li><p>inout代表即时输入参数，又是输出参数，表示该参数的值既可以由调用程序制定，又可以将inout参数的计算结果返回给调用程序。</p>
</li>
</ul>
</li>
<li><p>存储过程中的语句必须包含在BEGIN和END之间</p>
</li>
<li><p>DELIMITER是分割符，默认情况下DELIMITER是分号，遇到分号就执行。</p>
</li>
<li><p>DECLARE中用来声明变量，变量默认赋值使用DEFAULT，语句块中改变变量值，使用SET变量&#x3D;值</p>
</li>
<li><p>例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $$<br><br><span class="hljs-keyword">CREATE</span><br>    <span class="hljs-keyword">PROCEDURE</span> `demo`.`demo1`()<br>	<span class="hljs-comment">-- 存储过程体</span><br>	<span class="hljs-keyword">BEGIN</span><br>		<span class="hljs-comment">-- DECLARE声明 用来声明变量的</span><br>		<span class="hljs-keyword">DECLARE</span> de_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;&#x27;</span>;<br>		<br>		<span class="hljs-keyword">SET</span> de_name <span class="hljs-operator">=</span> &quot;jim&quot;;<br>		<br>		<span class="hljs-comment">-- 测试输出语句（不同的数据库，测试语句都不太一样。</span><br>		<span class="hljs-keyword">SELECT</span> de_name;<br>	<span class="hljs-keyword">END</span>$$<br><br>DELIMITER ;<br><span class="hljs-comment">-- 调用</span><br><span class="hljs-keyword">CALL</span> demo1();<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $$<br><br><span class="hljs-keyword">CREATE</span><br>    <span class="hljs-keyword">PROCEDURE</span> `demo`.`demo2`(<span class="hljs-keyword">IN</span> s_sex <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>),<span class="hljs-keyword">OUT</span> s_count <span class="hljs-type">INT</span>)<br>	<span class="hljs-comment">-- 存储过程体</span><br>	<span class="hljs-keyword">BEGIN</span><br>		<span class="hljs-comment">-- 把SQL中查询的结果通过INTO赋给变量</span><br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> s_count <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> sex<span class="hljs-operator">=</span> s_sex;<br>		<span class="hljs-keyword">SELECT</span> s_count;<br>		<br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER ;<br><span class="hljs-comment">-- 调用</span><br><span class="hljs-comment">-- @s_count表示测试出输出的参数</span><br><span class="hljs-keyword">CALL</span> demo2 (<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-variable">@s_count</span>);<br><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- if判断</span><br>DELIMITER $$<br><span class="hljs-keyword">CREATE</span><br>    <span class="hljs-keyword">PROCEDURE</span> `demo`.`demo3`(<span class="hljs-keyword">IN</span> `<span class="hljs-keyword">day</span>` <span class="hljs-type">INT</span>)<br>	<span class="hljs-comment">-- 存储过程体</span><br>	<span class="hljs-keyword">BEGIN</span><br>		IF `<span class="hljs-keyword">day</span>` <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span><br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;星期天&#x27;</span>;<br>		ELSEIF `<span class="hljs-keyword">day</span>` <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span><br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;星期一&#x27;</span>;<br>		ELSEIF `<span class="hljs-keyword">day</span>` <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span><br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;星期二&#x27;</span>;<br>		<span class="hljs-keyword">ELSE</span><br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;无效日期&#x27;</span>;<br>		<span class="hljs-keyword">END</span> IF;<br>		<br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER ;<br><span class="hljs-comment">-- case when判断</span><br>DELIMITER $$<br><span class="hljs-keyword">CREATE</span> <br>    <span class="hljs-keyword">PROCEDURE</span> demo5(<span class="hljs-keyword">IN</span> num <span class="hljs-type">INT</span>)<br>	<span class="hljs-keyword">BEGIN</span><br>		<span class="hljs-keyword">CASE</span> num  <span class="hljs-comment">-- 条件开始</span><br>		<span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <br>			<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;输入为1&#x27;</span>;<br>		<span class="hljs-keyword">WHEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <br>			<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;输入为0&#x27;</span>;<br>		<span class="hljs-keyword">ELSE</span> <br>		<span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;不是1也不是0&#x27;</span>;<br>		<span class="hljs-keyword">END</span> <span class="hljs-keyword">CASE</span>; <span class="hljs-comment">-- 条件结束</span><br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- while循环</span><br>DELIMITER $$<br><span class="hljs-keyword">CREATE</span> <br>    <span class="hljs-keyword">PROCEDURE</span> demo6(<span class="hljs-keyword">IN</span> num <span class="hljs-type">INT</span>,<span class="hljs-keyword">OUT</span> SUM <span class="hljs-type">INT</span>)<br>	<span class="hljs-keyword">BEGIN</span><br>	     <span class="hljs-keyword">SET</span> SUM <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>	     WHILE num<span class="hljs-operator">&lt;</span><span class="hljs-number">10</span> DO <span class="hljs-comment">-- 循环开始</span><br>	         <span class="hljs-keyword">SET</span> num <span class="hljs-operator">=</span> num<span class="hljs-operator">+</span><span class="hljs-number">1</span>;<br>	         <span class="hljs-keyword">SET</span> SUM <span class="hljs-operator">=</span> SUM<span class="hljs-operator">+</span>num;<br>	         <span class="hljs-keyword">END</span> WHILE; <span class="hljs-comment">-- 循环结束</span><br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER;<br><br><span class="hljs-comment">-- REPEAT...UNTIL语句的语法和Java中的do...while语句类似，都是先执行循环操作，再判断条件，区别就是REPEAT表达式值为false时才执行循环操作，直到表达式值为true停止</span><br><span class="hljs-comment">-- 创建过程</span><br>DELIMITER $$<br><span class="hljs-keyword">CREATE</span> <br>    <span class="hljs-keyword">PROCEDURE</span> demo7(<span class="hljs-keyword">IN</span> num <span class="hljs-type">INT</span>,<span class="hljs-keyword">OUT</span> SUM <span class="hljs-type">INT</span>)<br>	<span class="hljs-keyword">BEGIN</span><br>	     <span class="hljs-keyword">SET</span> SUM <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>	     REPEAT<span class="hljs-comment">-- 循环开始</span><br>		<span class="hljs-keyword">SET</span> num <span class="hljs-operator">=</span> num<span class="hljs-operator">+</span><span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">SET</span> SUM <span class="hljs-operator">=</span> SUM<span class="hljs-operator">+</span>num ;<br>		UNTIL num<span class="hljs-operator">&gt;=</span><span class="hljs-number">10</span><br>		<span class="hljs-keyword">END</span> REPEAT; <span class="hljs-comment">-- 循环结束</span><br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER;<br><br><span class="hljs-comment">-- LOOP循环语句，用来重复执行某些语句</span><br><span class="hljs-comment">-- 执行过程中可使用LEAVE语句或者ITERATE来跳出循环，也可以嵌套IF等判断语句</span><br><span class="hljs-comment">-- LEAVE语句效果对于Java中的break,用来终止循环</span><br><span class="hljs-comment">-- ITERATE语句效果相当于Java中的Continue，用来跳过此次循环。进入下一次循环，且ITERATE之下的语句将不在进行。</span><br>DELIMITER $$<br><span class="hljs-keyword">CREATE</span> <br>    <span class="hljs-keyword">PROCEDURE</span> demo8(<span class="hljs-keyword">IN</span> num <span class="hljs-type">INT</span>,<span class="hljs-keyword">OUT</span> SUM <span class="hljs-type">INT</span>)<br>	<span class="hljs-keyword">BEGIN</span><br>	     <span class="hljs-keyword">SET</span> SUM <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>	     demo_sum:LOOP<span class="hljs-comment">-- 循环开始</span><br>		<span class="hljs-keyword">SET</span> num <span class="hljs-operator">=</span> num<span class="hljs-operator">+</span><span class="hljs-number">1</span>;<br>		IF num <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">THEN</span><br>		    LEAVE demo_sum; <span class="hljs-comment">-- 结束此次循环</span><br>		ELSEIF num <span class="hljs-operator">&lt;</span> <span class="hljs-number">9</span> <span class="hljs-keyword">THEN</span><br>		    ITERATE demo_sum; <span class="hljs-comment">-- 跳过此次循环</span><br>		<span class="hljs-keyword">END</span> IF;<br>		<br>		<span class="hljs-keyword">SET</span> SUM <span class="hljs-operator">=</span> SUM<span class="hljs-operator">+</span>num;<br>		<span class="hljs-keyword">END</span> LOOP demo_sum; <span class="hljs-comment">-- 循环结束</span><br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER;<br><br></code></pre></td></tr></table></figure>

<ul>
<li><p>使用存储过程插入信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql">DELIMITER $$<br><span class="hljs-keyword">CREATE</span> <br>    <span class="hljs-keyword">PROCEDURE</span> demo9(<span class="hljs-keyword">IN</span> s_student <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),<span class="hljs-keyword">IN</span> s_sex <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>),<span class="hljs-keyword">OUT</span> s_result <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>))<br>	<span class="hljs-keyword">BEGIN</span><br>	   <span class="hljs-comment">-- 声明一个变量 用来决定这个名字是否已经存在</span><br>	   <span class="hljs-keyword">DECLARE</span> s_count <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>;<br>	   <span class="hljs-comment">-- 验证这么名字是否已经存在</span><br>	   <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">INTO</span> s_count <span class="hljs-keyword">FROM</span> student <span class="hljs-keyword">WHERE</span> `name` <span class="hljs-operator">=</span> s_student;	<br>	   IF s_count <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span><br>	        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> student (`name`, sex) <span class="hljs-keyword">VALUES</span>(s_student, s_sex);<br>		<span class="hljs-keyword">SET</span> s_result <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;数据添加成功&#x27;</span>;<br>	   <span class="hljs-keyword">ELSE</span><br>                <span class="hljs-keyword">SET</span> s_result <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;名字已存在，不能添加&#x27;</span>;<br>                <span class="hljs-keyword">SELECT</span> s_result;<br>	   <span class="hljs-keyword">END</span> IF;<br>	<span class="hljs-keyword">END</span>$$<br>DELIMITER;<br><span class="hljs-comment">-- 调用</span><br><span class="hljs-keyword">CALL</span> demo9(&quot;Jim&quot;,&quot;女&quot;,<span class="hljs-variable">@s_result</span>);<br><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><pre><code class="sql">SHOW PROCEDURE STATUS -- 显示存储过程
SHOW PROCEDURE STATUS WHERE db = &#39;db名字&#39; AND NAME = &#39;name名字&#39;;-- 显示特定数据库的存储过程
SHOW PROCEDURE STATUS WHERE NAME LIKE &#39;%mo%&#39;;-- 显示特定模式的存储过程
SHOW CREATE PROCEDURE 存储过程名;-- 显示存储过程源码
DROP PROCEDURE 存储过程名;-- 删除存储过程
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><br><span class="hljs-comment">## MySQL函数</span><br><br><span class="hljs-comment">### 函数定义</span><br><br>* MySQL的函数定义语法如下：<br><br>  <span class="hljs-string">``</span><span class="hljs-string">``</span>sql<br>      CREATE  <br>          [DEFINER = &#123; <span class="hljs-literal">user</span> | CURRENT_USER &#125;]<br>          <span class="hljs-keyword">FUNCTION</span> <span class="hljs-title function_">functionName</span> ( varName varType [, ... ] )<br>          RETURNS returnVarType<br>          [characteristic ...] <br>          routine_body<br></code></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>参数含义：</p>
<ul>
<li>functionName：函数名，同MySQL内置函数一样，大小写不敏感</li>
<li>varName：形参类型，其与varName配对使用。形参数量不限</li>
<li>returnVarType：返回值类型。函数必须有且只能有一个返回值</li>
<li>characteristic：函数特性</li>
<li>routine_body：函数体。函数体中必须含有return 语句，当函数体为复合结构时，需要使用begin….end语句</li>
</ul>
</li>
<li><pre><code class="sql">    create
        function myfun_getMax(num1 int, num2 int)
        returns int        
    begin
        declare res int;
        if(num1 &gt; num2) then
            set res = num1;
        elseif (num1 &lt; num2) then
            set res = num2;
        else
            set res = num1;
        end if;
        return res;
    end;
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs less"><br>### 表格值函数<br><br>* 内联表格值函数:返回一个表格<br><br>  ````<span class="hljs-selector-tag">sql</span><br>  <span class="hljs-selector-tag">create</span> <span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">tabcmess</span>(<span class="hljs-variable">@title</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">10</span>)) <span class="hljs-selector-tag">RETURNS</span> <span class="hljs-selector-tag">TABLE</span> <span class="hljs-selector-tag">as</span> <br>  <span class="hljs-selector-tag">return</span> (select title,des from product where title like <span class="hljs-string">&#x27;%&#x27;</span>+<span class="hljs-variable">@title</span>+<span class="hljs-string">&#x27;%&#x27;</span>)<br></code></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>多句表格值函数</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">  ````<br><br>  <br><br><br><br>## 常见问题<br><br>* [<span class="hljs-number">42000</span>][<span class="hljs-number">1118</span>] <span class="hljs-keyword">Row</span> size too <span class="hljs-keyword">large</span>. The maximum <span class="hljs-keyword">row</span> size <span class="hljs-keyword">for</span> the used <span class="hljs-keyword">table</span> <span class="hljs-keyword">type</span>, <span class="hljs-keyword">not</span> counting BLOBs, <span class="hljs-keyword">is</span> <span class="hljs-number">65535.</span> This includes <span class="hljs-keyword">storage</span> overhead, <span class="hljs-keyword">check</span> the manual. You have <span class="hljs-keyword">to</span> change <span class="hljs-keyword">some</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">to</span> <span class="hljs-type">TEXT</span> <span class="hljs-keyword">or</span> BLOBs<br>  - 行大小太大。所使用的表类型(不包括blob)的最大行大小是<span class="hljs-number">65535</span>。这包括存储开销，请参阅手册。您必须将一些列更改为<span class="hljs-type">TEXT</span>或blob<br>* 在MYSQL数据库中**一条记录**的**最大长度是<span class="hljs-number">65535</span>字节**，以下以Innodb和mysiam存储引擎为例，做了相关演示，不管任何存储引擎，都不能超过这个范围，即存储引擎支持一行存储更长的数据。<br>* Inodb存储引擎，对于<span class="hljs-number">4</span>K,<span class="hljs-number">8</span>K,<span class="hljs-number">16</span>K和<span class="hljs-number">32</span>K的页面大小，限制一条记录最多使用半个页面，，<span class="hljs-number">64</span>K页面比<span class="hljs-number">16</span>KB页面限制稍小一些。默认情况下，Innodb页面大小是<span class="hljs-number">16</span>KB<br>* mysql 字符所占字节数<br>  - utf<span class="hljs-number">-8</span>:中文占用<span class="hljs-number">3</span>个字节的存储，英文一个字节，中文三个字节。**UTF<span class="hljs-number">-8</span>则包含全世界所有国家需要用到的字符。**<br>  - utf8mb4最多支撑四个字节的存储，如emoji表情。中文三个字节。**utf8mb4专门用来兼容四字节的unicode。utf8mb4是utf8的超集，除了将编码改为utf8mb4外不需要做其他转换。**<br>  - GBK:中英文都是双字节。**GBK包含全部中文字符**<br>  - ASCII编码：一个英文字母（不分大小写）占用一个字节的空间，一个中文汉字占用两个字节的空间。<br>* 结论<br>  - **一条记录最大长度<span class="hljs-number">65535</span>字节**是MySQL数据库<span class="hljs-keyword">Server</span>层面的限制<br><br><br><br>* utf8mb4编码集中：<br>  - **utf8mb4_general_ci     不区分大小写** ci是<span class="hljs-keyword">case</span> insensitive的意思<br>  - utf8mb4_general_cs     区分大小写<br>  - utf8mb4_bin:字符串每个字符串用二进制数据编译存储。 区分大小写，而且可以存二进制的内容<br>*  utf8mb4_ unicode_ ci 与 utf8mb4_ general_ ci 如何选择<br>  字符除了需要存储，还需要排序或比较大小，涉及到与编码字符集对应的 排序字符集（<span class="hljs-keyword">collation</span>）。ut8mb4对应的排序字符集常用的有 utf8mb4_unicode_ci 、 utf8mb4_general_ci ，到底采用哪个在 stackoverflow 上有个讨论， What’s the difference <span class="hljs-keyword">between</span> utf8_general_ci <span class="hljs-keyword">and</span> utf8_unicode_ci<br>  **主要从排序准确性和性能两方面看**：<br>    **准确性**<br>    utf8mb4_unicode_ci 是基于标准的Unicode来排序和比较，能够在各种语言之间精确排序<br>    utf8mb4_general_ci 没有实现Unicode排序规则，在遇到某些特殊语言或字符是，排序结果可能不是所期望的。<br>    但是在绝大多数情况下，这种特殊字符的顺序一定要那么精确吗。比如Unicode把 ? 、 ? 当成 ss 和 OE 来看；而general会把它们当成 s 、 e ，再如 àá??ā? 各自都与 A 相等。<br>    **性能**<br>    utf8mb4_general_ci 在比较和排序的时候更快<br>    utf8mb4_unicode_ci 在特殊情况下，Unicode排序规则为了能够处理特殊字符的情况，实现了略微复杂的排序算法。<br>    但是在绝大多数情况下，不会发生此类复杂比较。general理论上比Unicode可能快些，但相比现在的CPU来说，它远远不足以成为考虑性能的因素，索引涉及、<span class="hljs-keyword">SQL</span>设计才是。 我个人推荐是 utf8mb4_unicode_ci ，将来 <span class="hljs-number">8.0</span> 里也极有可能使用变为默认的规则。<br><br><br><br>* max_allowed_packet设置问题<br>  - 报错信息&lt;font color=red&gt;packet <span class="hljs-keyword">for</span> query <span class="hljs-keyword">is</span> too <span class="hljs-keyword">large</span> (<span class="hljs-number">5</span>,<span class="hljs-number">352</span>,<span class="hljs-number">304</span> &gt; <span class="hljs-number">4</span>,<span class="hljs-number">194</span>,<span class="hljs-number">304</span>)&lt;/font&gt;<br>  - 原因分析：**mysql根据配置文件会限制<span class="hljs-keyword">server</span>接受的数据包大小。**有时候大的插入和更新会受max_allowed_packet参数限制，导致写入或者更新失败，导致项目访问异常。<br>  - 解决问题<br>    - <span class="hljs-keyword">show</span> VARIABLES <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%max_allowed_packet%&#x27;</span>;<br>      - 查看max_allowed_packet最大允许包<br>    - 方案<span class="hljs-number">1</span>：临时修改，**<span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> max_allowed_packet = <span class="hljs-number">2</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">10</span>; **（注意，这里的大小只能填写字节。重启mysql服务后，配置将会失效！）然后关闭掉这此mysql <span class="hljs-keyword">server</span>链接，再进入查看。<br>    - 方案<span class="hljs-number">2</span>:修改my.ini文件在[mysqld]部分加入 max_allowed_packet=大小，这里的大小可以写M<br>      - mysql <span class="hljs-comment">--help|grep my.cnf</span><br>    - 方案<span class="hljs-number">3</span>：<br>    - **官网给出的解决办法是加启动参数，找到mysql的启动脚本，把启动参数贴上**<br>  <br>* mysql <span class="hljs-type">TIMESTAMP</span>类型自动设置默认值的问题<br><br>  - 在实际生成中发现，为<span class="hljs-keyword">null</span>的数据同步到mysql后变成了当前的时间，建表语句却并未指定默认值。<br><br>  - 复现<br><br>  - ````mysql<br>    <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> dim.dim_test2<br>    (<br>        `id`              <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;主键&#x27;</span>,<br>        `enterprise_name` <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法识别涉及企业，逗号拼接&#x27;</span>,<br>        `<span class="hljs-keyword">type</span>`            <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法识别资讯类型（科技资讯，其他）&#x27;</span>,<br>        `source`          <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;来源&#x27;</span>,<br>        `article_content` <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;文章内容&#x27;</span>,<br>        `update_time`     <span class="hljs-type">TIMESTAMP</span>  <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>        `title`           <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;标题&#x27;</span>,<br>        `origin_link`     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;原文链接&#x27;</span>,<br>        `biz_unique_id`   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;业务唯一id&#x27;</span>,<br>        `publish_time`    <span class="hljs-type">TIMESTAMP</span>  <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;发布时间&#x27;</span>,<br>        `evaluate`        <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法分析新闻影响（正/负面、中立）&#x27;</span><br>    ) ENGINE = InnoDB<br>      <span class="hljs-keyword">DEFAULT</span> CHARSET = utf8mb4 <span class="hljs-keyword">COMMENT</span> =<span class="hljs-string">&#x27;资讯新闻信息表&#x27;</span>;<br>      <br>      <br>      <span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> dim.dim_test2;<br>      <br>      <span class="hljs-comment">-- show create table 后的结果</span><br>    <br>      <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `dim_test2` (<br>      `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;主键&#x27;</span>,<br>      `enterprise_name` <span class="hljs-type">text</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法识别涉及企业，逗号拼接&#x27;</span>,<br>      `<span class="hljs-keyword">type</span>` <span class="hljs-type">text</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法识别资讯类型（科技资讯，其他）&#x27;</span>,<br>      `source` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;来源&#x27;</span>,<br>      `article_content` <span class="hljs-type">text</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;文章内容&#x27;</span>,<br>      `update_time` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>      `title` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;标题&#x27;</span>,<br>      `origin_link` <span class="hljs-type">varchar</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;原文链接&#x27;</span>,<br>      `biz_unique_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;业务唯一id&#x27;</span>,<br>      `publish_time` <span class="hljs-type">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0000-00-00 00:00:00&#x27;</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;发布时间&#x27;</span>,<br>      `evaluate` <span class="hljs-type">text</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法分析新闻影响（正/负面、中立）&#x27;</span><br>    ) ENGINE=InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET=utf8mb4 <span class="hljs-keyword">COMMENT</span>=<span class="hljs-string">&#x27;资讯新闻信息表&#x27;</span><br>    <br>    <span class="hljs-comment">-- 解决办法：将timestamp的字段默认值设置为null</span><br>    <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> dim.dim_test2<br>    (<br>        `id`              <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;主键&#x27;</span>,<br>        `enterprise_name` <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法识别涉及企业，逗号拼接&#x27;</span>,<br>        `<span class="hljs-keyword">type</span>`            <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法识别资讯类型（科技资讯，其他）&#x27;</span>,<br>        `source`          <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;来源&#x27;</span>,<br>        `article_content` <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;文章内容&#x27;</span>,<br>        `update_time`     <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;更新时间&#x27;</span>,<br>        `title`           <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;标题&#x27;</span>,<br>        `origin_link`     <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;原文链接&#x27;</span>,<br>        `biz_unique_id`   <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;业务唯一id&#x27;</span>,<br>        `publish_time`    <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;发布时间&#x27;</span>,<br>        `evaluate`        <span class="hljs-type">TEXT</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">&#x27;算法分析新闻影响（正/负面、中立）&#x27;</span><br>    ) ENGINE = InnoDB<br>      <span class="hljs-keyword">DEFAULT</span> CHARSET = utf8mb4 <span class="hljs-keyword">COMMENT</span> =<span class="hljs-string">&#x27;资讯新闻信息表&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>可以发现TIMESTAMP默认加上了 NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</p>
</li>
<li><p>为防止这种情况，可以将timestamp的字段默认值设置为null。</p>
</li>
</ul>
</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/02/JVM/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JVM</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/23/java8-new-features/">
                        <span class="hidden-mobile">java8新特性</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
