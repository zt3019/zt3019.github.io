---
title: alibaba_big_data_road
date: 2024-02-27 18:54:45
hide: true
tags:
- 书籍
categories: 
- 大数据
index_img: https://tse3-mm.cn.bing.net/th/id/OIP-C.1NJoGdE-U58R_b66i8Sh2gHaK9?w=115&h=180&c=7&r=0&o=5&pid=1.7
banner_img: https://tse3-mm.cn.bing.net/th/id/OIP-C.1NJoGdE-U58R_b66i8Sh2gHaK9?w=115&h=180&c=7&r=0&o=5&pid=1.7
---

# 《大数据之路》

## 数据模型篇

### 第8章：大数据领域建模综述

- 数据仓库是一个**面向主题的、集成的、 非易失的且随时间变化的数据集合**，用来支持管理人员的**决策**。

* 好的数据建模会从以下几个方面带来提升：
  - 性能：良好的数据模型可以快速查询数据，减少I/O
  - 成本：减少非必要的数据冗余，计算结果的复用，降低大数据系统中的存储和计算成本
  - 效率：提升使用数据的体验，提高使用数据的效率
  - 质量：良好的数据模型可以改善数据口径的不一致，减少数据计算错误的可能性

#### OLAP和OLTP系统

* 埃德加·弗兰克·科德是“[关系模型](https://baike.baidu.com/item/关系模型/3189329?fromModule=lemma_inlink)”的发明者，关系型数据数据的鼻祖，之后类似于oracle,mysql相关的产品喷涌而出。OLTP系统（OnLine Transaction Processsing 联机事务处理）主要操作是数据随机读写，一般采用3NF的实体关系模型存储数据，从而在事务处理中解决数据的冗余和一致性问题。
* OLAP（OnLine Analytical Processing联机分析处理）主要面向批量读写，关注在大数据下的复杂查询问题

#### 维度模型

* Kimball维度建模主要探究需求分析，高层模型，详细模型，和模型审查的过程。一般构建维度模型要经历三个阶段：
  - 第一阶段是高层设计时期，定义业务过程维度模型的范围，提供每种星形模型的技术和功能描述。
  - 第二阶段是详细模型设计时期，对每个星形模型添加属性和度量信息
  - 第三阶段是进行模型的审查，再设计和验证等工作
  - 第四阶段是产生详细设计文档，提交ETL设计和开发

* 维度模型是数据仓库领域的 Ralph Kimball 大师所倡导的，是目前数仓领域最流行的
* 维度建模从**分析决策的需求**出发构建模型，为分析需求服务，因此它重点关注用户如何能更快速地完成需求分析。同时具有较好的大规模复杂查询的响应性能。其典型的代表是星形模型，以及在一些特殊场景下
* 基本步骤
  - 选择需要进行分析决策的业务过程。业务过程可以是单个业务事件，比如交易的支付、退款等；也可以是某个事件的状态，比如当前的账户余额等；还可以是一系列相关业务事件组成的业务流程，具体需要看我们分析的是某些事件发生情况，还是当前状态，或是事件流转效率。
  - 选择粒度。在事件分析中，我们要预判所有分析需要细分的程度，从而决定选择的粒度。粒度是维度的一个组合。
  - 识别维表。选择好粒度之后，就需要基于此粒度设计维表，包括维度属性，用于分析时进行分组和筛选。
  - 选择事实。确定分析需要衡量的指标

### 第九章：数据整合及管理体系

* OneData 即是阿里巴巴内部进行数据整合及管理的方法体系和工具。阿里巴巴的大数据工程师在这一体系下，构建统 、规范、可共的全域数据体系，避免数据的冗余和重复建设，规避数据烟囱和不一致性，充分发挥阿里巴巴在大数据海量、多样性方面的独特优势。借助统一化数据整合及管理的方法体系，我们构建了阿里巴巴的数据公共层，并可以帮助相似的大数据项目快速落地实现。

#### 9.1概览

* 体系架构[![pkIxq74.png](https://s21.ax1x.com/2024/07/17/pkIxq74.png)](https://imgse.com/i/pkIxq74)
  - 业务板块：根据公司的业务属性，分出几个相对独立的业务板块，业务板块之间重叠性较小
  - 规范定义：设计一套数据规范命名体系，规范定义会在模型设计中体现出来
  - 模型设计：以维度建模理论为基础，基于维度建模总线架构，构建一致性的维度和事实

#### 9.2 规范定义

* 规范定义指以维度建模作为理论基础 构建总线矩阵，划分和定义数据域、业务过程、维度、度量 原子指标、修饰类型、修饰词、时间周期、派生指标。
  - [![pkIziHe.png](https://s21.ax1x.com/2024/07/17/pkIziHe.png)](https://imgse.com/i/pkIziHe)
  - 名词解释[![pkIztg0.png](https://s21.ax1x.com/2024/07/17/pkIztg0.png)](https://imgse.com/i/pkIztg0)
* 指标体系
  - [![pkopPFH.png](https://s21.ax1x.com/2024/07/17/pkopPFH.png)](https://imgse.com/i/pkopPFH)
  - 原子指标，修饰类型及修饰词，直接归属在业务过程下，其中修饰词继承修饰类型的数据域
  - 派生指标可以选择多个修饰词，修饰词之间的关系为“或”或者“且”，由具体的派生指标语决定。
  - 派生指标唯一归属一个原子指标 ，继承原子指标的数据域， 与修饰词的数据域无关。
  - 指标命名要清晰。可以参考书本第九章143页的内容
    - [![pkopV6P.png](https://s21.ax1x.com/2024/07/17/pkopV6P.png)](https://imgse.com/i/pkopV6P)
  - 派生指标分为三类：事务型指标，存量型指标和复合型指标。
    - 事务型指标 是指对业务活动进行衡量的指标。例如新发商品数、重发商品数、新增注册会员数、订单支付金额，这类指标需维护原子指标及修饰词，在此基础上创建派生指标。
    - 存量型指标：是指对实体对象（如商品、会员）某些状态的统计。例如商品总数、注册会员总数，这类指标需维护原子指标及修饰词，在此基础上创建派生指标，对应的时间周期 般为“历史截至当前某个时间”。
    - 复合型指标：是在事务型指标和存量型指标的基础上复合而成的。例如浏览 UV－下单买家数转化率 有些需要 建新原子指标，有些则可以在事务型或存量型原子指标的基础上增加修饰词得到派生指标。

#### 9.3模型设计

* 模型层次关系图[![pkoplfs.png](https://s21.ax1x.com/2024/07/17/pkoplfs.png)](https://imgse.com/i/pkoplfs)
  - 操作数据层（ ODS ）：把操作系统数据几乎无处理地存放在数据仓库系统中。
  - 公共维度模型层（ CDM ）：存放明细事实数据、维表数据及公共指标汇总数据。 其中明细事实数据、维表数 一般根据 ODS 层数据加工生成 ：公共指标汇总数据 般根据维表数据和明细事实数据加工生成。
    - CDM层又细分为DWD层和DWS层，分别是明细数据层和汇总数据层，**采用维度模型方法作为理论基础，更多的采用一些维度退化手法，将维度退化至事实表中，减少事实表和维表的关联，提高明细数据表的易用性。（DWD）同时在汇总数据层，加强指标的维度退化，采用更多的宽表化手段构建公共指标数据层，提升公共指标的复用性，减少重复加工。(DWS)**
      - 组合相关和相似数据：采用明细宽表，复用关联计算，减少数据扫描。
      - 公共指标统一加工：基于 OneData 体系构建命名规范、口径一致和算法统一的统计指标，为上层数据产品、应用和服务提供公共指标；建立逻辑汇总宽表。
  - 应用数据层（ADS）：存放数据产品个性化的统计指标数据。根据CDM层和ODS层加工生成
    - 个性化指标加工：不公用性，复杂性
    - 基于应用的数据组装，大宽表集市，趋势指标串
  - 数据模型架构[![pkopbB8.png](https://s21.ax1x.com/2024/07/17/pkopbB8.png)](https://imgse.com/i/pkopbB8)
* CDM层的一些简单的规范：1.高内聚，低耦合。2.数据可回滚（多次运行，结果一致）。3.命名清晰，可理解，一致性（表和字段命名清晰，相同含义字段在不同表命名要相同）

#### 9.4 模型实施

* Kimball维度建模实施过程：第一个阶段是高层设计时期定义业务过程维度模型的范围，提供每种星型模式的技术和功能描述；第二个阶段是详细模型设计时期，对每个星形模型添加属性和度量信息；第三个阶段是进行模型的审查、再设计和验证等工作；第四个阶段是产生详细设计文档，提交 ETL 设计和开发。

  - 高层模型
    - 高层模型设计阶段的直接产出目标是创建高层维度模型图，它是对业务过程中的维表和事实表的图形描述。确定维表创建初始属性列表，为每个事实表创建提议度量。
  - 详细模型
    - 详细的维度建模过程是为高层模型填补缺失的信息，解决设计问题，并不断测试模型能否满足业务需求，确保模型的完备性。确定每个维表的属性和每个事实表的度量，并确定信息来源的位置、定义，确定属性和度量如何填人模型的初步业务规则。
  - 模型审查，再设计和验证
    - 本阶段主要召集相关人员进行模型的审查和验证，根据审查结果对详细维度进行再设计。
  - 提交ETL设计和开发
    - 最后，完成模型详细设计文档，提交ETL 开发人员，进入ETL设计和开发阶段，由 ETL 人员完成物理模型的设计和开发。

* 阿里OneData体系下的数仓实施过程

  - [![数仓实施流程](https://s21.ax1x.com/2024/07/17/pko9MDK.png)](https://imgse.com/i/pko9MDK)

  - 数据调研

    - 业务调研，页业务系统要充分了解，有条件可以多使用，多感受，看数据是怎么流动的。得出业务板块，业务系统的一些信息，可以抽象整理成具体的表

    - [![业务调研流程](https://s21.ax1x.com/2024/07/17/pko93Ue.png)](https://imgse.com/i/pko93Ue)
    - [![业务动作](https://s21.ax1x.com/2024/07/17/pko9WrV.png)](https://imgse.com/i/pko9WrV)
    - 需求调研：与分析师，业务运营人员沟通数据需求

  - 数据域划分：根据业务过程进行归纳，抽象出数据域

    - [![数据域划分](https://s21.ax1x.com/2024/07/17/pkoCniQ.png)](https://imgse.com/i/pkoCniQ)

  - 构建总线矩阵：在充分的业务调研和需求调研后，就可以构建总线矩阵了。主要是两件事：明确每个数据域下有哪些业务过程；业务过程与哪些维度相关，并定义每个数据域下的业务过程和维度。

    - [![总线矩阵](https://s21.ax1x.com/2024/07/17/pkoCKRs.png)](https://imgse.com/i/pkoCKRs)

  - 规范定义：规范定义主要定义指标体系，包括原子指标，修饰词，时间周期和派生指标

  - 模型设计：主要就是CDM层的设计，维度和属性的规范定义。是核心内容

* OneData实施过程是一个高度迭代和动态的过程,一般采用螺旋式实施方法。在总体架构设计完成之后，开始根据数据域进行迭代式模型设计和评审。在架构设计、规范定义和模型设计等模型实施过程中，都会引人评审机制，以确保模型实施过程的正确性。

### 第十章：维度设计

* 维度是维度建模的基础和灵魂。在维度建模中，将度量称为`事实`，将环境描述为`维度`。维度是用于分析事实所需要的多种环境。
* 维度所包含的列表示维度的列，称为维度属性。维度属性是查询约束条件，分组和报表标签生成的基本来源。

#### 10.1：维度的基本设计方法

* 第一步：**选择维度或新建维度。**作为维度建模的核心，在企业级数据仓库中必须保证维度的唯一性。作为维度建模的核心，在企业级数据仓库中必须保证维度的唯一性。以淘宝商品维度为例，有且只允许有一个维度定义。
* 第二步：**确定主维表。**此处的主维表一般是 ODS 表，直接与业务系统同步。以淘宝商品维度为例， _auction_ auctions 是与前台商品中心系统同步的商品表，此表即是主维表。
* 第三步：**确定相关维表。**数据仓库是业务源系统的数据整合，不同业务系统或者同 业务系统中的表之间存在关联性。根据对业务的梳理，确定哪些表和主维表存在关联关系，并选择其中的某些表用于生成维度属性。以淘宝商品维度为例，根据对业务逻辑的梳理，可以得到商品与类目、 SPU 卖家、店铺等维度存在关联关系。
* 第四步：**确定维度属性。**包括两步
  - 从主维表中选择维度属性或生成新的维度属性
  - 从相关维表中选择维度属性或生成新的维度属性。
    - 以淘宝商品维度为例，从**主维表**（ s_auction_auctions ）**和类目、 SPU 、卖家、店铺等相关维表**中选择维度属性或生成新的维度属性。
* 确定维度的几个要点：
  - 尽可能生成丰富的维度属性
  - 尽可能多地给出包括一些富有意义的文字性描述
  - 区分数值型属性和事实
  - 尽量沉淀出通用的维度属性

#### 10.2维度设计高级主题

##### 10.2.1维度整合

##### 10.2.2 水平拆分

##### 10.2.3 垂直拆分

##### 10.2.4 历史归档

#### 10.3 维度变化

##### 10.3.1缓慢变化维

##### 10.3.2 快照维表

##### 10.3.3 极限存储

##### 10.3.4 微型维度

#### 10.4 特殊维度

##### 10.4.1 递归层次

##### 10.4.2 行为维度

##### 10.4.3 多值维度

##### 10.4.4 多值属性

##### 10.4.5 杂项维度



### 第十一章事实表设计









## 数据管理篇

### 第12章：元数据

#### 技术元数据

* 技术元数据市存储关于数据仓库系统技术细节的数据，**是用于开发和管理数据仓库使用的数据**。常见的技术元数据有：
  - **分布式计算系统存储元数据，如表，列，分区等信息。**分区信息、责任人信息、文件大小、表类型，生命周期，以及列的字段名、字段类型、字段备注、是否是分区字段等信息。
  - **分布式计算系统运行元数据。**如hive的Job日志，包括作业类型，实例名称，输入输出，sql，运行参数，执行时间，运行日志等信息
  - **数据开发平台中的同步任务，计算任务，任务调度信息。**包括数据同步的输入输出表和字段，以及同步任务本身的节点信息：计算任务主要有输入输出、任务本身的节点信息 任务调度主要有任务的依赖类型、依赖关系等，以及不同类型调度任务的运行日志等。
  - **数据质量和运维相关元数据。**如任务监控、运维报警、数据质量、故障等信息，包括任务监控运行日志、告警配置及运行日志、故障信息等。

#### 业务元数据

* 业务元数据从业务角度描述了数据仓库中的数据。常见的元数据有：
  - **维度建模元数据，如维度及属性，业务过程，指标等规范化定义，用于更好地管理和使用数据**
  - **数据应用元数据**，如数据报表，数据产品等的配置和运行元数据。

#### 元数据体系建设

* 元数据的质量直接影响到数据管理的准确性。元数据建设的目标是打通数据接入到加工，再到数据消费整个链路，规范元数据体系与模型，提供统一的元数据出口，保障元数据产出的稳定性和质量

